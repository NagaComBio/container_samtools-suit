# Use the alpine:bookworm-slim image as the base
FROM alpine:bookworm-slim

# Install necessary packages
RUN apk add --no-cache wget tar build-base zlib-dev bzip2-dev xz-dev ncurses-dev

# Install htslib 1.21
RUN wget https://github.com/samtools/htslib/releases/download/1.21/htslib-1.21.tar.bz2 && \
    tar -vxjf htslib-1.21.tar.bz2 && \
    cd htslib-1.21 && \
    ./configure && \
    make && \
    make install && \
    cd .. && \
    rm -rf htslib-1.21.tar.bz2 htslib-1.21

# Install bcftools 1.21
RUN wget https://github.com/samtools/bcftools/releases/download/1.21/bcftools-1.21.tar.bz2 && \
    tar -vxjf bcftools-1.21.tar.bz2 && \
    cd bcftools-1.21 && \
    ./configure && \
    make && \
    make install && \
    cd .. && \
    rm -rf bcftools-1.21.tar.bz2 bcftools-1.21

# Install samtools 1.21
RUN wget https://github.com/samtools/samtools/releases/download/1.21/samtools-1.21.tar.bz2 && \
    tar -vxjf samtools-1.21.tar.bz2 && \
    cd samtools-1.21 && \
    ./configure && \
    make && \
    make install && \
    cd .. && \
    rm -rf samtools-1.21.tar.bz2 samtools-1.21

# Export environment variables
ENV HTSLIB_LIBRARY_DIR=/usr/local/lib \
    HTSLIB_INCLUDE_DIR=/usr/local/include \
    LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
